ymaps.ready(ymapsReady);
function ymapsReady() {
	var yMap_ = new ymaps.Map('map', {
		center:[53.617306, 23.816951],
		zoom: 18,
		controls: []
	});

	var yPlacemark_ = new ymaps.Placemark([53.617306, 23.816951], {
		//balloonContentBody: 'Детсткий развивающий центр КАРКУША',
	}, {
		iconLayout: 'default#image',
		iconImageHref: 'images/placemark-karkusha.svg',
		iconImageSize: [216, 136],
		iconImageOffset: [-108, -68]
	});

	var yClusterer_ = new ymaps.Clusterer({
		clusterDisableClickZoom: false,
		clusterOpenBalloonOnClick: false,
	});

	yClusterer_.add(yPlacemark_);
	yMap_.geoObjects.add(yClusterer_);
}

$(document).ready(function() {
	var headerHeight = $('header').outerHeight();
	$(document).on('click', '.menu a', function(_event) {
		_event.preventDefault();
		var linkHref = $(this).attr('href');
		$('html, body').animate({
			scrollTop: ($(linkHref).offset().top - headerHeight - 20)
		}, 500);
	});

	$(document).on('click', '.mobile-menu-open', function(_event) {
		$('.popup-menu').fadeIn();
	});

	$(document).on('click', '.popup-menu .menu__link', function(_event) {
		$('.popup-menu').fadeOut();
	});

	$(document).on('click', '.mobile-contact-open', function(_event) {
		$('.popup-contacts').fadeIn();
	});

	$(document).on('click', '.open-popup', function(_event) {
		_event.preventDefault();
		$('.popup-sign-in').fadeIn();
		$('body').css('overflow', 'hidden');
	});

	$(document).on('click', '.popup .overflow', function(_event) {
		_event.preventDefault();
		$(this).parent().fadeOut();
		$('body').css('overflow', 'visible');
	});

	$(document).on('click', '.popup__close, .popup__close-desctop', function(_event) {
		$(this).parent().parent().fadeOut();
		$('body').css('overflow', 'visible');
	});

	$(document).on('click', '.about__text-mobile-more', function(_event) {
		$(this).hide();
		$('.about__text_mobile-hidden').show();
	});

	if(document.documentElement.clientWidth < 740) {
		var swiper = new Swiper('.swiper-container', {
			breakpoints: {
				540: {
					slidesPerView: 'auto'
				}
			},
			scrollbar: {
				el: '.swiper-scrollbar'
			},
			slidesPerView: 'auto',
			spaceBetween: 16
		});
	}

	$('[data-fancybox="gallery"]').fancybox({
		buttons: [
			'close'
		],
		mobile: {
			thumbs: {
				autoStart: false
			}
		}
	});

	$(document).on('click', '.open-gallery', function(_event) {
		_event.preventDefault();
		$.fancybox.open($('[data-fancybox="gallery"]'), {
			buttons: [
				'close'
			],
			mobile: {
				thumbs: {
					autoStart: false
				}
			}
		});
	});

	$(document).on('submit', 'form.js-form', function(_event) {
		var $FORM_ = $(this);
		if ($FORM_.hasClass('js-form--locked')) {
			return false;
		}

		$FORM_.addClass('js-form--locked');

		var $button_ = $FORM_.find('[type="submit"]');
		//var valButton_ = $button_.val();
		//$button_.val('');

		$FORM_.find('.error').removeClass('error');
		$FORM_.find('.error__message').remove();

		$.ajax({
			url: $FORM_.attr('action'),
			type: 'POST',
			async: true,
			cache: false,
			data: $FORM_.serialize(),
			dataType: 'json',
			error: function(_XHR, _status, _error) {
			},
			success: function(_response, _status, _XHR) {
				if (_response && 'status' in _response) {
					if ('window' in _response) {
						$FORM_.find('.error').removeClass('error');
						$FORM_.find('.error__message').remove();

						$FORM_[0].reset();

						$('.popup').fadeOut();
						$('.popup-thank .top').html(_response['window']);
						$('.popup-thank').fadeIn();
						setTimeout(function() {
							$('.popup-thank').fadeOut();
						}, 2500);
						$('body').css('overflow', 'visible');
					} else {
						switch (_response['status']) {
							case 'fail':
								if ('errors' in _response) {
									for (var _key in _response['errors']) {
										var $control_ = $FORM_.find('[name="' + _key + '"]');
										$control_.parent().addClass('error');
										var $hint_ = $('<span/>', {
											'class': 'error__message',
											'text': _response['errors'][_key]
										});
										$control_.after($hint_);
									}
								}
								break;
						}
					}
				}
			},
			complete: function(_XHR, _status) {
				$FORM_.removeClass('js-form--locked');

				//$button_.val(valButton_);
			}
		});

		return false;
	});
});
